#include "stdio.h" 
#include "math.h"

double ga1[6]={ 57568490574.0,-13362590354.0,651619640.7,
		-11214424.18,77392.33017,-184.9052456};
double gb1[6]={ 57568490411.0,1029532985.0,
		9494680.718,59272.64853,267.8532712,1.0};
double gc1[6]={ 72362614232.0,-7895059235.0,242396853.1,
		-2972611.439,15704.4826,-30.16036606};
double gd1[6]={ 144725228443.0,2300535178.0,18583304.74,
		99447.43394,376.9991397,1.0};
double ge1[5]={ 1.0,-0.1098628627e-02,
		0.2734510407e-04,-0.2073370639e-05,0.2093887211e-06};
double gf1[5]={ -0.1562499995e-01,0.1430488765e-03,
		-0.6911147651e-05,0.7621095161e-06,-0.934935152e-07};
double gg1[5]={ 1.0,0.183105e-02,-0.3516396496e-04,
		0.2457520174e-05,-0.240337019e-06};
double gh1[5]={ 0.4687499995e-01,-0.2002690873e-03,0.8449199096e-05,
		-0.88228987e-06,0.105787412e-06};

double bessel1(int n,double  x)
{ 
	int    i,m;
	double t,y,z,p,q,s,b0,b1;
	
	t=fabs(x);	
	if (n<0) n=-n;
	if (n!=1)	{ 
		if (t<8.0){ 
			y=t*t; p=ga1[5]; q=gb1[5];
			for (i=4; i>=0; i--){ 
				p*=y; p+=ga1[i]; 
				q*=y; q+=gb1[i];
			}
			p/=q;
		}
		else{ 
			z=8.0/t; y=z*z;	p=ge1[4]; q=gf1[4];
			for (i=3; i>=0; i--){ 
				p*=y; p+=ge1[i]; 
				q*=y; q+=gf1[i];
			}
			s=t-0.785398164;
			p*=cos(s); p-=z*q*sin(s);	p*=sqrt(0.636619772/t);
		}
	}
	if (n==0) return(p);
	b0=p;
	if (t<8.0){ 
		y=t*t; p=gc1[5]; q=gd1[5];
		for (i=4; i>=0; i--){ 
			p*=y; p+=gc1[i]; 
			q*=y; q+=gd1[i];
		}
		p*=x/q;
	}
	else{ 
		z=8.0/t; y=z*z;	p=gg1[4]; q=gh1[4];
		for (i=3; i>=0; i--){ 
			p*=y; p+=gg1[i]; 
			q*=y; q+=gh1[i];
		}
		s=t-2.356194491;
		p*=cos(s); p-=z*q*sin(s);	p*=x*sqrt(0.636619772/t)/t;
	}
	if (n==1) return(p);
	b1=p;
	if (x==0.0) return(0.0);
	s=2.0/t;
	if (t>n){ 
		if (x<0.0) b1=-b1;
		for (i=1; i<n; i++){ 
			p=s*i*b1-b0; b0=b1; b1=p;
		}
	}
	else{ 
		m=n+(int)sqrt(40.0*n); m>>=1; m<<=1;
		p=0.0; q=0.0; b0=1.0; b1=0.0;
		for (i=m-1; i>=0; i--){ 
			t=s*(i+1)*b0-b1;
			b1=b0; b0=t;
			if (fabs(b0)>1.0e+10){ 
				b0*=1.0e-10;b1*=1.0e-10;p*=1.0e-10;q*=1.0e-10;
			}
			if ((i+2)%2==0) q+=b0;
			if ((i+1)==n) p=b1;
		}
		q*=2.0; q-=b0; p=p/q;
	}
	if(x<0.0)
		if(n%2==1) p=-p;
	return(p);
}

double ga2[6]={ -2.957821389e+9,7.062834065e+9,-5.123598036e+8,
		1.087988129e+7,-8.632792757e+4,2.284622733e+2};
double gb2[6]={ 4.0076544269e+10,7.452499648e+8,
		7.189466438e+6,4.74472647e+4,2.261030244e+2,1.0};
double gc2[6]={ -4.900604943e+12,1.27527439e+12,-5.153438139e+10,
		7.349264551e+8,-4.237922726e+6,8.511937935e+3};
double gd2[7]={ 2.49958057e+13,4.244419664e+11,3.733650367e+9,
		2.245904002e+7,1.02042605e+5,3.549632885e+2,1.0};
double ge2[5]={ 1.0,-0.1098628627e-02,0.2734510407e-04,
		-0.2073370639e-05,0.2093887211e-06};
double gf2[5]={ -0.1562499995e-01,0.1430488765e-03,-0.6911147651e-05,
		0.7621095161e-06,-0.934935152e-07};
double gg2[5]={ 1.0,0.183105e-02,-0.3516396496e-04,
		0.2457520174e-05,-0.240337019e-06};
double gh2[5]={ 0.4687499995e-01,-0.2002690873e-03,0.8449199096e-05,
		-0.88228987e-06,0.105787412e-06};

double bessel2(int n,double  x)
{ 
	int i;
	double y,z,p,q,s,b0,b1;
	
	if (x==0.0) return(-1.0e+70);
	x=fabs(x);
	if (n<0) n=-n;
	if (n!=1){ 
		if (x<8.0){ 
			y=x*x; p=ga2[5]; q=gb2[5];
			for (i=4; i>=0; i--){ 
				p*=y; p+=ga2[i]; 
				q*=y; q+=gb2[i];
			}
			p/=q; p+=0.636619772*bessel1(0,x)*log(x);
		}
		else{ 
			z=8.0/x; y=z*z;	p=ge2[4]; q=gf2[4];
			for (i=3; i>=0; i--){ 
				p*=y; p+=ge2[i]; 
				q*=y; q+=gf2[i];
			}
			s=x-0.785398164;
			p*=sin(s); p+=z*q*cos(s);	p*=sqrt(0.636619772/x);
		}
	}
	if (n==0) return(p);
	b0=p;
	if (x<8.0){ 
		y=x*x; p=gc2[5]; q=gd2[6];
		for (i=4; i>=0; i--){ 
			p*=y; p+=gc2[i]; 
			q*=y; q+=gd2[i+1];
		}
		q*=y; q+=gd2[0];
		p*=x/q; p+=0.636619772*(bessel1(1,x)*log(x)-1.0/x);
	}
	else{ 
		z=8.0/x; y=z*z;	p=gg2[4]; q=gh2[4];
		for (i=3; i>=0; i--){ 
			p*=y; p+=gg2[i]; 
			q*=y; q+=gh2[i];
		}
		s=x-2.356194491;
		p*=sin(s); p+=z*q*cos(s);	p*=sqrt(0.636619772/x);
	}
	if (n==1) return(p);
	b1=p;
	s=2.0/x;
	for (i=1; i<n; i++){ 
		p=s*i*b1-b0; b0=b1; b1=p;
	}
	return(p);
}

main()
{ 
	int n;

	for (n=0; n<5; n++){          
		printf("\nbessel2(%d,%4.2f)=%e",n,(n+1)*0.05,bessel2(n,(n+1)*0.05));
	}
}


